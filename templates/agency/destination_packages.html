{% extends 'base.html' %}
{% block content %}

<style>
    :root {
        --blue: #1E3A8A;
        --gold: #FACC15;
        --white: #ffffff;
        --gray: #4B5563;
        --light-blue: #EEF3FF;
        --border: #D1D5DB;
    }

    .page-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--blue);
        margin-bottom: 20px;
    }

    .package-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 22px;
    }

    .card {
        width: 260px;
        background: var(--white);
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        padding: 14px;
        border: 1px solid var(--border);
        transition: transform 0.2s;
    }

    .card:hover {
        transform: translateY(-4px);
    }

    .card img {
        width: 100%;
        height: 155px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .card-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--blue);
        margin-bottom: 8px;
    }

    .info-text {
        font-size: 14px;
        color: var(--gray);
        margin-bottom: 6px;
    }

    .read-more {
        color: var(--blue);
        text-decoration: underline;
        font-weight: 600;
    }

    .wishlist-btn {
        width: 100%;
        padding: 8px 10px;
        background: var(--white);
        color: var(--blue);
        border: 2px solid var(--blue);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 10px;
    }

    .wishlist-btn:hover {
        background: var(--light-blue);
    }

    .book-btn {
        width: 100%;
        padding: 10px;
        background: var(--gold);
        color: var(--blue);
        border: none;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 10px;
    }

    .book-btn a {
        text-decoration: none;
        color: var(--blue);
        font-weight: 700;
    }

    .book-btn:hover {
        background: #e4b60f;
    }

</style>

<h2 class="page-title">Packages for {{ destination.name }}</h2>

{% if packages %}
    <div class="package-grid">
        {% for pkg in packages %}
            <div class="card">

                {% if pkg.image %}
                    <img src="{{ pkg.image.url }}" alt="{{ pkg.package_name }}">
                {% endif %}

                <h3 class="card-title">{{ pkg.package_name }}</h3>

                <!-- Rating -->
                {% if pkg.avg_rating %}
                    <p class="info-text">⭐ Average Rating: {{ pkg.avg_rating|floatformat:1 }}/5</p>
                {% else %}
                    <p class="info-text">No ratings yet</p>
                {% endif %}

                <p class="info-text"><strong>Price:</strong> ₹{{ pkg.price }}</p>
                <p class="info-text"><strong>Duration:</strong> {{ pkg.duration }}</p>

                <p class="info-text">
                    {{ pkg.description|truncatechars:100 }}
                    <a class="read-more" href="{% url 'package_detail' pkg.id %}">Read more</a>
                </p>

                <!-- Wishlist -->
                <form method="post" action="{% url 'add_to_wishlist' 'package' pkg.id %}">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn">♡ Add to Wishlist</button>
                </form>

                <!-- Booking -->
                {% if user.is_authenticated and user.is_traveler %}
                    <button class="book-btn">
                        <a href="{% url 'book_package' pkg.id %}">Book Now</a>
                    </button>
                {% elif not user.is_authenticated %}
                    <p class="info-text">
                        <a href="{% url 'login' %}" class="read-more">Login to Book</a>
                    </p>
                {% endif %}
            </div>
        {% endfor %}
    </div>

{% else %}
    <p class="info-text">No packages available for this destination.</p>
{% endif %}

{% endblock %}
